@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.FluentUI.AspNetCore.Components
@using Microsoft.FluentUI.AspNetCore.Components.DesignTokens
@using System.Diagnostics.CodeAnalysis
@using snowcoreBlog.Frontend.SharedComponents.Components.Fluent
@using snowcoreBlog.Frontend.SharedComponents.LayoutHooks

@inherits LayoutComponentBase

@inject BodyFont BodyFont

<FluentDesignTheme Mode="DesignThemeModes.Dark" StorageName="theme" />
<FluentToastProvider />
<FluentDialogProvider />
<FluentTooltipProvider />
<FluentMenuProvider />

<div class="root-layout-item">
    <FluentLayout @ref="_root">
        <AuthorizeView>
            <Authorized>
                <main>
                    <FluentStack Class="h-100" VerticalGap="0" Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.Stretch">
                        <GeneralHeader Title="snowcore's Blog" LogoSvg="<svg/>" AccountLink="@string.Empty" NavLinks="@(new PublicApi.Utilities.Dictionary.DictionaryWithDefault<string, string>(defaultValue: string.Empty, 0)
                            {
                                ["Home"] = "home",
                                ["Blog"] = "blog",
                                ["About"] = "about"
                            })">
                        </GeneralHeader>
                        <FluentMessageBarProvider Section="@LayoutSections.TopMessageBar" />
                        <LayoutHookHost />
                        <article class="h-100">
                            @Body
                        </article>
                    </FluentStack>
                </main>
            </Authorized>
            <NotAuthorized>
                <main>
                    <FluentStack Class="h-100" VerticalGap="0" Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.Stretch">
                        <GeneralHeader Title="snowcore's Blog" LogoSvg="<svg/>" AccountLink="login" NavLinks="@(new PublicApi.Utilities.Dictionary.DictionaryWithDefault<string, string>(defaultValue: string.Empty, 0)
                            {
                                ["Home"] = "home",
                                ["Blog"] = "blog",
                                ["About"] = "about"
                            })">
                        </GeneralHeader>
                        <FluentMessageBarProvider Section="@LayoutSections.TopMessageBar" />
                        <LayoutHookHost />
                        <article class="h-100">
                            @Body
                        </article>
                    </FluentStack>
                </main>
            </NotAuthorized>
            <Authorizing>
                <main>
                    <FluentStack Orientation="Orientation.Vertical">
                        <GeneralHeader Title="snowcore's Blog" LogoSvg="<svg/>" AccountLink="login" NavLinks="@(new PublicApi.Utilities.Dictionary.DictionaryWithDefault<string, string>(defaultValue: string.Empty, 0)
                            {
                                ["Home"] = "home",
                                ["Blog"] = "blog",
                                ["About"] = "about"
                            })">
                        </GeneralHeader>
                        <article>
                            <FluentLabel>Please wait, we are authorizing the user.</FluentLabel>
                        </article>
                    </FluentStack>
                </main>
            </Authorizing>
        </AuthorizeView>
    </FluentLayout>
</div>

@code
{
    private FluentLayout _root = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        
        if (firstRender)
        {
            await BodyFont.SetValueFor(_root.Element, "Source Sans 3");
        }
    }
}